<th:block th:fragment="status (np)">
    <th:block th:if="${np == null}"></th:block>
    <th:block th:unless="${np == null}">
        <tr th:class="'playstatus-' + ${np.transferId} + ' mediafile-' + ${np.mediaFileId}">
            <td colspan="2" class="detail" style="padding-top:1em;white-space:nowrap">
                <!-- avatar -->
                <img th:if="${np.avatarScheme == 'SYSTEM'}"
                         alt="Avatar"
                         th:src="@{/avatar.view(id=${np.systemAvatarId})}"
                         style="padding-right:5pt;width:30px;height:30px"/>

                <img th:if="${np.avatarScheme == 'CUSTOM' and np.hasCustomAvatar}"
                         alt="Avatar"
                         th:src="@{/avatar.view(username=${np.username})}"
                         style="padding-right:5pt;width:30px;height:30px"/>

                <b th:text="${np.username}"></b>
            </td>
        </tr>

        <tr th:class="'playstatus-' + ${np.transferId} + ' mediafile-' + ${np.mediaFileId}">
            <td class="detail" style="padding-right:1em">

                <!-- Link to album (main). Title (tooltip) is generated by template -->
                <a th:href="@{/main.view(id=${np.mediaFileId})}"
                     target="main"
                     th:attr="title=${np.artist} + ' â€“ ' + ${np.title}">

                    <span th:if="${np.artist != null}" th:text="${np.artist}"></span>
                    <br th:if="${np.artist != null}"/>
                    <span class="songTitle" th:text="${np.title}"></span>
                </a>
                <br/>

                <!-- Lyrics link (only if needed). UTF-8 encoding is handled by @{...} -->
                <span class="forward" th:if="${np.showLyrics}">
                    <a th:href="@{/lyrics.view(artist=${np.artist}, song=${np.title})}"
                         onclick="return popupSize(this, 'lyrics', 500, 550)"
                         th:text="#{main.lyrics}">Lyrics</a>
                </span>
            </td>

            <td>
                <a th:href="@{/main.view(id=${np.mediaFileId})}"
                     target="main"
                     th:attr="title=${np.artist} + ' - ' + ${np.title}">
                    <img alt="Cover art"
                             th:src="@{/coverArt.view(size=60, id=${np.mediaFileId})}"
                             class="dropshadow" height="60" width="60"/>
                </a>
            </td>
        </tr>

        <tr th:if="${np.minutesAgo > 4}"
                th:class="'playstatus-' + ${np.transferId} + ' mediafile-' + ${np.mediaFileId}">
            <td class="detail" colspan="2">
                <span th:text="${np.minutesAgo}"></span>
                <span th:text="#{main.minutesago}"></span>
            </td>
        </tr>
    </th:block>
</th:block>